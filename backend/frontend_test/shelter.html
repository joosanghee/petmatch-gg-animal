<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PetMatch - ë³´í˜¸ì†Œ</title>
  <link rel="stylesheet" href="{{ url_for('serve_css') }}" />
</head>
<body>
  <header class="topbar">
    <div class="brand"><a href="/" style="text-decoration:none; color:inherit;">ğŸ¾ PetMatch</a></div>
    <nav class="nav">
      <a href="/animals">ìœ ê¸°ë™ë¬¼</a>
      <a href="/shelter">ë³´í˜¸ì†Œ</a>
      <a href="/hospital">ë³‘ì›/ì•½êµ­</a>
      
      {% if session['user_id'] %}
        <span style="font-size:14px; font-weight:bold; margin-right:4px;">{{ session['user_name'] }}ë‹˜</span>
        
        {% if session.get('is_admin') == 1 %}
          <a class="btn primary" href="/admin" style="padding: 6px 12px; font-size: 13px;">ê´€ë¦¬ì</a>
        {% else %}
          <a href="/mypage" style="font-weight:bold; color:var(--accent);">ë§ˆì´í˜ì´ì§€</a>
        {% endif %}

        <a class="btn ghost" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
      {% else %}
        <a class="btn ghost" href="/login">ë¡œê·¸ì¸</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">
    <section class="hero" style="margin-bottom:16px;">
      <h1 style="margin-bottom:8px;">ë³´í˜¸ì†Œ ì •ë³´</h1>
      <p style="margin-bottom:14px;">ë³´í˜¸ì†Œ ì—°ë½ì²˜ì™€ ì£¼ì†Œë¥¼ í™•ì¸í•˜ê³ , ê³µê³  ë™ë¬¼ì„ ì°¾ì•„ë³´ì„¸ìš”.</p>

      <div class="searchbar">
        <input id="keywordInput" placeholder="ë³´í˜¸ì†Œ ì´ë¦„, ì£¼ì†Œ ê²€ìƒ‰" value="{{ curr_keyword }}" onkeypress="handleEnter(event)"/>
        <button class="btn primary" onclick="applyFilters()">ê²€ìƒ‰</button>
      </div>
      
    </section>

    <section class="layout">
      <aside class="filters">
        <h2>í•„í„°</h2>
        <label class="field">
          <span>ì§€ì—­</span>
          <select id="regionFilter">
            <option value="ì „ì²´">ì „ì²´</option>
            
            {% for area in region_list %}
              <option value="{{ area }}" {% if curr_region == area %}selected{% endif %}>
                {{ area }}
              </option>
            {% endfor %}
            
          </select>
        </label>
        
        <button class="btn primary full" style="margin-top:6px;" onclick="applyFilters()">ì ìš©</button>
        <button class="btn ghost full" style="margin-top:8px;" onclick="location.href='/shelter'">ì´ˆê¸°í™”</button>
      </aside>

      <section class="results">
        <div class="results-head">
          <div>ê²°ê³¼ <b>{{ shelters|length }}</b>ê³³</div>
          <select class="sort"><option>ê°€ë‚˜ë‹¤ìˆœ</option></select>
        </div>

        <div class="grid">
          {% if shelters %}
            {% for shelter in shelters %}
            <article class="card">
              <div class="thumb" style="background-color: #f8f9fa; display:flex; align-items:center; justify-content:center;">
                <span style="font-size:24px;">ğŸ </span>
              </div>
              <div class="card-body">
                <div class="title">{{ shelter['name'] }}</div>
                <div class="meta">ìˆ˜ìš©ê°€ëŠ¥: {{ shelter['capacity'] }}ë§ˆë¦¬</div>
                <div class="meta">â˜ {{ shelter['phone'] }}</div>
                <div class="meta">ì£¼ì†Œ: {{ shelter['address'] }}</div>
                <div class="actions">
                  <a class="btn primary" href="https://map.naver.com/v5/search/{{ shelter['address'] }}" target="_blank">ì§€ë„ ë³´ê¸°</a>
                  <button class="btn ghost">ë³µì‚¬</button>
                </div>
              </div>
            </article>
            {% endfor %}
          {% else %}
            <p style="padding:20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          {% endif %}
        </div>
      </section>
    </section>
  </main>

  <script>
    function applyFilters() {
      const keyword = document.getElementById('keywordInput').value;
      const region = document.getElementById('regionFilter').value;

      let url = `/shelter?keyword=${encodeURIComponent(keyword)}`;
      if (region !== 'ì „ì²´') url += `&region=${encodeURIComponent(region)}`;
      window.location.href = url;
    }
    
    function quickRegion(regionName) {
        window.location.href = `/shelter?region=${encodeURIComponent(regionName)}`;
    }
    
    function handleEnter(e) { if(e.key === 'Enter') applyFilters(); }
  </script>
</body>
</html>