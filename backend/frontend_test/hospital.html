<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PetMatch - ë™ë¬¼ë³‘ì›/ì•½êµ­</title>
  <link rel="stylesheet" href="{{ url_for('serve_css') }}" />
</head>
<body>
  <header class="topbar">
    <div class="brand"><a href="/" style="text-decoration:none; color:inherit;">ğŸ¾ PetMatch</a></div>
    <nav class="nav">
      <a href="/animals">ìœ ê¸°ë™ë¬¼</a>
      <a href="/shelter">ë³´í˜¸ì†Œ</a>
      <a href="/hospital">ë³‘ì›/ì•½êµ­</a>
      
      {% if session['user_id'] %}
        <span style="font-size:14px; font-weight:bold; margin-right:4px;">{{ session['user_name'] }}ë‹˜</span>
        <a class="btn ghost" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
      {% else %}
        <a class="btn ghost" href="/login">ë¡œê·¸ì¸</a>
      {% endif %}
    </nav>
  </header>

  <main class="container">
    <section class="hero" style="margin-bottom:16px;">
      <h1 style="margin-bottom:8px;">ë™ë¬¼ë³‘ì› Â· ë™ë¬¼ì•½êµ­</h1>
      <p style="margin-bottom:14px;">ê·¼ì²˜ ë³‘ì›/ì•½êµ­ ì—°ë½ì²˜ì™€ ì£¼ì†Œë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ì„¸ìš”.</p>
      
      <div class="searchbar">
        <input id="keywordInput" placeholder="ì´ë¦„, ì£¼ì†Œ í‚¤ì›Œë“œ ê²€ìƒ‰" value="{{ curr_keyword }}" onkeypress="handleEnter(event)"/>
        <button class="btn primary" onclick="applyFilters()">ê²€ìƒ‰</button>
      </div>
    </section>

    <section class="layout">
      <aside class="filters">
        <h2>í•„í„°</h2>
        <label class="field">
          <span>êµ¬ë¶„</span>
          <select id="typeFilter">
            <option value="ì „ì²´">ì „ì²´</option>
            <option {% if curr_type=='ë™ë¬¼ë³‘ì›' %}selected{% endif %}>ë™ë¬¼ë³‘ì›</option>
            <option {% if curr_type=='ë™ë¬¼ì•½êµ­' %}selected{% endif %}>ë™ë¬¼ì•½êµ­</option>
          </select>
        </label>
        
        <label class="field">
          <span>ì§€ì—­</span>
          <select id="regionFilter">
            <option value="ì „ì²´">ì „ì²´</option>
            <option {% if curr_region=='ìˆ˜ì›' %}selected{% endif %}>ìˆ˜ì›</option>
            <option {% if curr_region=='ì„±ë‚¨' %}selected{% endif %}>ì„±ë‚¨</option>
            <option {% if curr_region=='ìš©ì¸' %}selected{% endif %}>ìš©ì¸</option>
            <option {% if curr_region=='ê³ ì–‘' %}selected{% endif %}>ê³ ì–‘</option>
            </select>
        </label>
        
        <button class="btn primary full" style="margin-top:6px;" onclick="applyFilters()">ì ìš©</button>
        <button class="btn ghost full" style="margin-top:8px;" onclick="location.href='/hospital'">ì´ˆê¸°í™”</button>
      </aside>

      <section class="results">
        <div class="results-head">
          <div>ê²°ê³¼ <b>{{ entities|length }}</b>ê³³</div>
          <select class="sort"><option>ê°€ë‚˜ë‹¤ìˆœ</option></select>
        </div>

        <div class="grid">
          {% if entities %}
            {% for item in entities %}
            <article class="card">
              <div class="thumb" style="background-color: #f4f4f4; display:flex; align-items:center; justify-content:center;">
                 <span style="font-size:24px;">{% if item['type'] == 'ë™ë¬¼ë³‘ì›' %}ğŸ¥{% else %}ğŸ’Š{% endif %}</span>
              </div>
              <div class="card-body">
                <div class="title">{{ item['name'] }}</div>
                <div class="meta" style="font-weight:bold; color: {% if item['type']=='ë™ë¬¼ë³‘ì›' %}var(--accent){% else %}#3b82f6{% endif %};">
                  {{ item['type'] }}
                </div>
                <div class="meta">â˜ {{ item['phone'] }}</div>
                <div class="meta">ì£¼ì†Œ: {{ item['address'] }}</div>
                <div class="actions">
                  <a class="btn primary" href="https://map.naver.com/v5/search/{{ item['address'] }}" target="_blank">ì§€ë„ ë³´ê¸°</a>
                  <button class="btn ghost">ë³µì‚¬</button>
                </div>
              </div>
            </article>
            {% endfor %}
          {% else %}
            <p style="padding:20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          {% endif %}
        </div>
      </section>
    </section>
  </main>

  <script>
    function applyFilters() {
      const keyword = document.getElementById('keywordInput').value;
      const type = document.getElementById('typeFilter').value;
      const region = document.getElementById('regionFilter').value;

      let url = `/hospital?keyword=${encodeURIComponent(keyword)}`;
      if (type !== 'ì „ì²´') url += `&type=${encodeURIComponent(type)}`;
      if (region !== 'ì „ì²´') url += `&region=${encodeURIComponent(region)}`;
      
      window.location.href = url;
    }
    function handleEnter(e) { if(e.key === 'Enter') applyFilters(); }
  </script>
</body>
</html>